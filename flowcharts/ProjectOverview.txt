site: https://mermaid.live/

flowchart TD
    %% Start and Configuration Phase
    A[ðŸš€ UDSv4 QC Validator Start] --> B[ðŸ“‹ Configuration Management]
    
    B --> B1[ðŸ”§ Load Environment Variables]
    B --> B2[ðŸ“ Load Configuration Files]
    B --> B3[ðŸ” Load JSON Rule Mappings]
    
    B1 --> C{âœ… Configuration Valid?}
    B2 --> C
    B3 --> C
    
    C -->|âŒ No| C1[ðŸ“ Log Configuration Errors]
    C1 --> C2[ðŸ›‘ Exit with Error Code]
    
    C -->|âœ… Yes| D[ðŸŒ API Pull & Data Fetching]
    
    %% API Pull and Data Fetching Phase
    D --> D1[ðŸ”‘ REDCap API Authentication]
    D --> D2[ðŸŽ¯ Apply Data Filters]
    D --> D3[ðŸ“Š Fetch Raw Data from REDCap]
    
    D1 --> E{ðŸ” API Pull Success?}
    D2 --> E
    D3 --> E
    
    E -->|âŒ No| E1[ðŸ“ Log API Errors]
    E1 --> E2[ðŸ›‘ Exit with API Error]
    
    E -->|âœ… Yes| F[ï¿½ Data Routing & Schema Building]
    
    %% Data Routing with Schema Building and Rule Allocation
    F --> F1[ðŸ“‹ Identify Instrument Types]
    F --> F2[ï¿½ Determine Packet Types]
    F --> F3[ðŸ—ï¸ Build Dynamic Schema per Instrument]
    F --> F4[ï¿½ Allocate Rules per Packet Type]
    
    F1 --> G{ðŸ“Š Schema & Routing Complete?}
    F2 --> G
    F3 --> G
    F4 --> G
    
    G -->|âŒ No| G1[ðŸ“ Log Routing Errors]
    G1 --> G2[âš ï¸ Handle Missing Schema/Rules]
    G2 --> F
    
    G -->|âœ… Yes| H[ðŸŽ¯ NACC Form Validation Processing]
    
    %% Validation Processing Using NACC Form Validators at Variable Level
    H --> H1{ðŸ“‹ Select Packet Type Rules}
    
    H1 --> H2[ðŸ“ I - Baseline New Participant Rules]
    H1 --> H3[ðŸ“ I4 - Baseline Returning Participant Rules]
    H1 --> H4[ðŸ“ F - Follow-up Visit Rules]
    
    H2 --> I1[ï¿½ Variable-Level NACC Validation]
    H3 --> I2[ï¿½ Variable-Level NACC Validation]
    H4 --> I3[ï¿½ Variable-Level NACC Validation]
    
    I1 --> J[ðŸ§ª Apply Form-Specific Rules]
    I2 --> J
    I3 --> J
    
    J --> J1[ðŸ”¬ Field-Level Validation]
    J1 --> J2[ðŸ“Š Cross-Variable Logic Checks]
    J2 --> J3[âš¡ Real-time Error Detection]
    
    J3 --> K{âœ… Validation Results}
    
    %% Results Processing
    K -->|âœ… Pass| L1[âœ… Variable Accepted]
    K -->|âŒ Fail| L2[âŒ Variable Validation Errors]
    K -->|âš ï¸ Warning| L3[âš ï¸ Variable Validation Warnings]
    
    L1 --> M[ðŸ“ˆ Results Aggregation by Instrument]
    L2 --> M
    L3 --> M
    
    %% Logging Processing Phase
    M --> N[ðŸ“ Comprehensive Logging Processing]
    
    N --> N1[ðŸ“Š Performance Metrics Logging]
    N --> N2[ðŸ” Audit Trail Generation]
    N --> N3[âš ï¸ Error & Warning Log Processing]
    N --> N4[ðŸ’¾ Validation Results Tracking]
    
    N1 --> O{ðŸ“‹ Logging Complete?}
    N2 --> O
    N3 --> O
    N4 --> O
    
    O -->|âŒ No| O1[ðŸ“ Log Processing Errors]
    O1 --> O2[âš ï¸ Continue with Available Logs]
    O2 --> P
    
    O -->|âœ… Yes| P[ðŸ“Š Output Building & Generation]
    
    %% Output Building and Output Phase
    P --> P1[ðŸ“ Create Timestamped Output Directory]
    P --> P2[ðŸ“‹ Generate CSV Reports by Instrument]
    P --> P3[ðŸ“„ Generate JSON Validation Results]
    P --> P4[ðŸŒ Generate HTML Dashboards]
    P --> P5[ðŸ“ˆ Generate Quality Metrics Reports]
    
    P1 --> Q[ï¿½ Final Output Delivery]
    P2 --> Q
    P3 --> Q
    P4 --> Q
    P5 --> Q
    
    Q --> Q1[ðŸ“Š Validation Summary Report]
    Q --> Q2[âŒ Error Details Report]
    Q --> Q3[ðŸ“ˆ Quality Metrics Dashboard]
    Q --> Q4[ðŸ” Audit Trail Documentation]
    Q --> Q5[ðŸ’¾ Processed Data Archive]
    
    Q1 --> R[âœ… Process Completion]
    Q2 --> R
    Q3 --> R
    Q4 --> R
    Q5 --> R
    
    R --> S[ï¿½ Workflow Complete]
    
    %% Error Recovery Flows
    G2 --> T[ï¿½ Retry Schema Building]
    T --> F3
    
    O2 --> U[âš ï¸ Partial Output Generation]
    U --> P2
    
    %% Styling for better visualization
    
    %% Configuration Phase - Blue tones
    style A fill:#e1f5fe,stroke:#0277bd,stroke-width:3px
    style B fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style B1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    style B2 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    style B3 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    
    %% Decision Points - Yellow/Orange
    style C fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style E fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style G fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style H1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style K fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style O fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    %% Error States - Red tones
    style C1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style C2 fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    style E1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style E2 fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    style G1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style G2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style O1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style O2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style L2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    
    %% API and Data Fetching - Green tones
    style D fill:#e8f5e8,stroke:#388e3c,stroke-width:3px
    style D1 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style D2 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style D3 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    
    %% Data Routing and Schema Building - Purple tones
    style F fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style F1 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style F2 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style F3 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style F4 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    
    %% NACC Validation Processing - Deep Purple tones
    style H fill:#e8eaf6,stroke:#3f51b5,stroke-width:3px
    style H2 fill:#c5cae9,stroke:#303f9f,stroke-width:1px
    style H3 fill:#c5cae9,stroke:#303f9f,stroke-width:1px
    style H4 fill:#c5cae9,stroke:#303f9f,stroke-width:1px
    style I1 fill:#9fa8da,stroke:#1a237e,stroke-width:1px
    style I2 fill:#9fa8da,stroke:#1a237e,stroke-width:1px
    style I3 fill:#9fa8da,stroke:#1a237e,stroke-width:1px
    style J fill:#7986cb,stroke:#1a237e,stroke-width:2px
    style J1 fill:#5c6bc0,stroke:#1a237e,stroke-width:1px
    style J2 fill:#5c6bc0,stroke:#1a237e,stroke-width:1px
    style J3 fill:#5c6bc0,stroke:#1a237e,stroke-width:1px
    
    %% Success States - Light Green
    style L1 fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    style L3 fill:#fff8e1,stroke:#ffa000,stroke-width:2px
    
    %% Results Aggregation - Teal
    style M fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    
    %% Logging Processing - Gray tones
    style N fill:#f5f5f5,stroke:#616161,stroke-width:3px
    style N1 fill:#fafafa,stroke:#757575,stroke-width:1px
    style N2 fill:#fafafa,stroke:#757575,stroke-width:1px
    style N3 fill:#fafafa,stroke:#757575,stroke-width:1px
    style N4 fill:#fafafa,stroke:#757575,stroke-width:1px
    
    %% Output Building and Generation - Cyan tones
    style P fill:#e0f7fa,stroke:#00838f,stroke-width:3px
    style P1 fill:#b2ebf2,stroke:#006064,stroke-width:1px
    style P2 fill:#b2ebf2,stroke:#006064,stroke-width:1px
    style P3 fill:#b2ebf2,stroke:#006064,stroke-width:1px
    style P4 fill:#b2ebf2,stroke:#006064,stroke-width:1px
    style P5 fill:#b2ebf2,stroke:#006064,stroke-width:1px
    
    %% Final Output Delivery - Deeper Cyan
    style Q fill:#80deea,stroke:#00695c,stroke-width:3px
    style Q1 fill:#4dd0e1,stroke:#004d40,stroke-width:1px
    style Q2 fill:#4dd0e1,stroke:#004d40,stroke-width:1px
    style Q3 fill:#4dd0e1,stroke:#004d40,stroke-width:1px
    style Q4 fill:#4dd0e1,stroke:#004d40,stroke-width:1px
    style Q5 fill:#4dd0e1,stroke:#004d40,stroke-width:1px
    
    %% Completion - Success Green
    style R fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    style S fill:#a5d6a7,stroke:#1b5e20,stroke-width:4px
    
    %% Recovery Flows - Light Blue
    style T fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
    style U fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
