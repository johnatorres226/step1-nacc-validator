site: https://mermaid.live/

flowchart TD
    %% Start and Configuration Phase
    A[ðŸš€ UDSv4 QC Validator Start] --> B[ðŸ“‹ Configuration Management]
    
    B --> B1[ðŸ”§ Load Environment Variables]
    B --> B2[ðŸ“ Validate Paths & Settings]
    B --> B3[ðŸ” Load JSON Rule Mappings]
    
    B1 --> C{âœ… Configuration Valid?}
    B2 --> C
    B3 --> C
    
    C -->|âŒ No| C1[ðŸ“ Log Configuration Errors]
    C1 --> C2[ðŸ›‘ Exit with Error Code]
    
    C -->|âœ… Yes| D[ðŸ”„ Initialize ETL Pipeline]
    
    %% Data Fetching Phase
    D --> E[ðŸŒ REDCap Data Fetching]
    
    E --> E1[ðŸ”‘ API Authentication]
    E --> E2[ðŸŽ¯ Apply Filter Logic]
    E --> E3[ðŸ“Š Fetch Raw Data]
    
    E1 --> F{ðŸ” Authentication Success?}
    E2 --> F
    E3 --> F
    
    F -->|âŒ No| F1[ðŸ“ Log API Errors]
    F1 --> F2[ðŸ›‘ Exit with API Error]
    
    F -->|âœ… Yes| G[ðŸ”§ Data Processing Pipeline]
    
    %% Data Processing and Validation
    G --> G1[ðŸ§¹ Data Validation & Cleaning]
    G --> G2[ðŸ”„ Data Transformation]
    G --> G3[ðŸ“‹ Record Type Detection]
    
    G1 --> H{ðŸ“Š Data Valid?}
    G2 --> H
    G3 --> H
    
    H -->|âŒ No| H1[ðŸ“ Log Data Quality Issues]
    H1 --> H2[âš ï¸ Generate Error Reports]
    
    H -->|âœ… Yes| I[ðŸŽ¯ Quality Control Engine]
    
    %% QC Validation Engine
    I --> I1{ðŸ“‹ Determine Packet Type}
    
    I1 --> I2[ðŸ“ Form A1 - Initial Visit]
    I1 --> I3[ðŸ“ Form B1 - Follow-up]
    I1 --> I4[ðŸ“ Form C2 - Neuropsych]
    I1 --> I5[ðŸ“ Form I4 - Initial (Form 4)]
    I1 --> I6[ðŸ“‚ Other Forms]
    
    I2 --> J1[ðŸ“– Load a1.json Rules]
    I3 --> J2[ðŸ“– Load b1.json Rules]
    I4 --> J3[ðŸ“– Load c2.json Rules]
    I5 --> J4[ðŸ“– Load i4.json Rules]
    I6 --> J5[ðŸ“– Load Respective Rules]
    
    J1 --> K[ðŸ” Apply Schema Validation]
    J2 --> K
    J3 --> K
    J4 --> K
    J5 --> K
    
    K --> L[ðŸ§ª Custom NACC Validation]
    L --> M[ðŸ”¬ Field-Level Validation]
    M --> N[ðŸ“Š Cross-Field Logic Checks]
    
    N --> O{âœ… Validation Results}
    
    %% Results Processing
    O -->|âœ… Pass| P1[âœ… Record Accepted]
    O -->|âŒ Fail| P2[âŒ Validation Errors Found]
    O -->|âš ï¸ Warning| P3[âš ï¸ Validation Warnings]
    
    P1 --> Q[ðŸ“ˆ Results Aggregation]
    P2 --> Q
    P3 --> Q
    
    %% Output and Reporting Phase
    Q --> R[ðŸ“Š Output Management System]
    
    R --> R1[ðŸ“ Create Timestamped Directory]
    R --> R2[ðŸ“‹ Generate CSV Reports]
    R --> R3[ðŸ“„ Generate JSON Outputs]
    R --> R4[ðŸŒ Generate HTML Dashboards]
    
    R1 --> S[ðŸ“ˆ Report Generation]
    R2 --> S
    R3 --> S
    R4 --> S
    
    S --> S1[ðŸ“Š Validation Summary Report]
    S --> S2[âŒ Error Details Report]
    S --> S3[ðŸ“ˆ Quality Metrics Dashboard]
    S --> S4[ðŸ” Audit Trail Documentation]
    
    %% Logging and Monitoring
    S1 --> T[ðŸ“ Comprehensive Logging]
    S2 --> T
    S3 --> T
    S4 --> T
    
    T --> T1[ðŸ“Š Performance Metrics]
    T --> T2[ðŸ” Audit Trail Logging]
    T --> T3[âš ï¸ Error & Warning Logs]
    T --> T4[ðŸ’¾ Database Tracking]
    
    T1 --> U[âœ… Process Completion]
    T2 --> U
    T3 --> U
    T4 --> U
    
    U --> V[ðŸ“¬ Final Output Delivery]
    
    %% Error Handling Flows
    H2 --> W[ðŸ”„ Continue Processing]
    W --> I
    
    %% Styling for better visualization
    
    %% Configuration Phase - Blue tones
    style A fill:#e1f5fe,stroke:#0277bd,stroke-width:3px
    style B fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style B1 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    style B2 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    style B3 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    
    %% Decision Points - Yellow/Orange
    style C fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style F fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style H fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style I1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style O fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    %% Error States - Red tones
    style C1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style C2 fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    style F1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style F2 fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    style H1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style H2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style P2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    
    %% Data Processing - Green tones
    style D fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    style E fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    style G fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    style E1 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style E2 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style E3 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style G1 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style G2 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    style G3 fill:#f1f8e9,stroke:#689f38,stroke-width:1px
    
    %% QC Validation - Purple tones
    style I fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style I2 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style I3 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style I4 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style I5 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style I6 fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    style J1 fill:#f8bbd9,stroke:#ad1457,stroke-width:1px
    style J2 fill:#f8bbd9,stroke:#ad1457,stroke-width:1px
    style J3 fill:#f8bbd9,stroke:#ad1457,stroke-width:1px
    style J4 fill:#f8bbd9,stroke:#ad1457,stroke-width:1px
    style J5 fill:#f8bbd9,stroke:#ad1457,stroke-width:1px
    style K fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    style L fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    style M fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    style N fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    
    %% Success States - Light Green
    style P1 fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    style P3 fill:#fff8e1,stroke:#ffa000,stroke-width:2px
    
    %% Output and Reporting - Cyan tones
    style Q fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    style R fill:#e0f2f1,stroke:#00796b,stroke-width:3px
    style S fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    style R1 fill:#e0f7fa,stroke:#0097a7,stroke-width:1px
    style R2 fill:#e0f7fa,stroke:#0097a7,stroke-width:1px
    style R3 fill:#e0f7fa,stroke:#0097a7,stroke-width:1px
    style R4 fill:#e0f7fa,stroke:#0097a7,stroke-width:1px
    style S1 fill:#b2dfdb,stroke:#00695c,stroke-width:1px
    style S2 fill:#b2dfdb,stroke:#00695c,stroke-width:1px
    style S3 fill:#b2dfdb,stroke:#00695c,stroke-width:1px
    style S4 fill:#b2dfdb,stroke:#00695c,stroke-width:1px
    
    %% Logging - Gray/Silver tones
    style T fill:#f5f5f5,stroke:#616161,stroke-width:2px
    style T1 fill:#fafafa,stroke:#757575,stroke-width:1px
    style T2 fill:#fafafa,stroke:#757575,stroke-width:1px
    style T3 fill:#fafafa,stroke:#757575,stroke-width:1px
    style T4 fill:#fafafa,stroke:#757575,stroke-width:1px
    
    %% Final Steps - Success Green
    style U fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    style V fill:#a5d6a7,stroke:#1b5e20,stroke-width:3px
    
    %% Continue Processing - Light Blue
    style W fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
